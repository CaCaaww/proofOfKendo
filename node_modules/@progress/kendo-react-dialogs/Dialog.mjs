/**
 * @license
 *-------------------------------------------------------------------------------------------
 * Copyright Â© 2025 Progress Software Corporation. All rights reserved.
 * Licensed under commercial license. See LICENSE.md in the package root for more information
 *-------------------------------------------------------------------------------------------
 */
import * as o from "react";
import * as w from "react-dom";
import s from "prop-types";
import { DialogTitleBar as F } from "./DialogTitleBar.mjs";
import { DialogActionsBar as p } from "./DialogActionsBar.mjs";
import { dispatchEvent as A, Keys as N, keepFocusInContainer as k, canUseDOM as n, getActiveElement as S, ZIndexContext as d, FOCUSABLE_ELEMENTS as O, focusFirstFocusableChild as P, classNames as Z, createPropsContext as _, withIdHOC as B, withPropsContext as L } from "@progress/kendo-react-common";
import { getMaxZIndex as K } from "./utils.mjs";
import { DEFAULT_DIALOGS_ZINDEX as M, ZINDEX_DIALOGS_STEP as h, DATA_DIALOGS_ID as z } from "./constants.mjs";
const i = class i extends o.Component {
  constructor(e) {
    super(e), this.context = 0, this.titleId = this.generateTitleId(), this.contentId = this.generateContentId(), this.activeElement = null, this.onCloseDialog = (t) => {
      t.preventDefault(), A(this.props.onClose, t, this, void 0);
    }, this.onKeyDown = (t) => {
      t.keyCode === N.esc && this.props.onClose && (t.preventDefault(), this.onCloseDialog(t)), k(t, this.element);
    }, this.getCurrentZIndex = () => !this.state || this.context === void 0 ? this.context ? this.context : M : this.state.zIndex > (this.context ? this.context + h : 0) ? this.state.zIndex : this.context + h, this.getDocument = () => {
      const t = n ? document : null;
      return this.props.appendTo ? this.props.appendTo.ownerDocument : t;
    }, n && (this.activeElement = S(document));
  }
  get _id() {
    return this.props.id + "-accessibility-id";
  }
  /**
   * @hidden
   */
  componentDidMount() {
    if (this.element) {
      if (this.props.autoFocus && !this.props.autoFocusedElement)
        this.element.focus();
      else if (this.props.autoFocus && this.props.autoFocusedElement)
        this.element.focus();
      else if (!this.props.autoFocus && this.props.autoFocusedElement) {
        const e = this.element.querySelector(
          this.props.autoFocusedElement
        );
        e && e.focus();
      } else {
        const e = [...O].map(
          (t) => t + ":not(.k-dialog-titlebar *)"
        );
        P(this.element, e);
      }
      this.setState({
        zIndex: K(this.getCurrentZIndex(), this.getDocument(), this._id)
      });
    }
  }
  /**
   * @hidden
   */
  componentWillUnmount() {
    setTimeout(() => {
      var e;
      !this.element && this.activeElement && n && (document.contains(this.activeElement) ? this.activeElement.focus() : this.activeElement.id && ((e = document.getElementById(this.activeElement.id)) == null || e.focus()));
    });
  }
  /**
   * @hidden
   */
  render() {
    const e = this.props.id !== void 0 ? this.props.id : this.titleId, { title: t, width: m, height: u, children: f, minWidth: g, dir: y, style: I, contentStyle: E, modal: D = !0 } = this.props, l = o.Children.toArray(f), C = this.getContent(l), x = this.getActionBar(l), v = t ? {
      "aria-labelledby": e
    } : null, T = this.props.closeIcon !== void 0 ? this.props.closeIcon : !0, a = this.getCurrentZIndex(), c = /* @__PURE__ */ o.createElement(d.Provider, { value: a }, /* @__PURE__ */ o.createElement(
      "div",
      {
        [z]: this._id,
        className: "k-dialog-wrapper" + (this.props.className ? " " + this.props.className : ""),
        onKeyDown: this.onKeyDown,
        tabIndex: 0,
        dir: y,
        style: {
          zIndex: a,
          ...I
        },
        ref: (b) => {
          this.element = b;
        }
      },
      D && /* @__PURE__ */ o.createElement("div", { className: "k-overlay", style: this.props.overlayStyle }),
      /* @__PURE__ */ o.createElement(
        "div",
        {
          ...v,
          className: Z("k-window k-dialog", {
            [`k-window-${this.props.themeColor}`]: this.props.themeColor
          }),
          role: "dialog",
          "aria-labelledby": e,
          "aria-modal": !0,
          "aria-describedby": this.contentId,
          style: { width: m, height: u, minWidth: g }
        },
        this.props.title && /* @__PURE__ */ o.createElement(F, { closeIcon: T, onCloseButtonClick: this.onCloseDialog, id: e }, t),
        /* @__PURE__ */ o.createElement("div", { className: "k-window-content k-dialog-content", style: E, id: this.contentId }, C),
        x
      )
    ));
    return n ? this.props.appendTo !== null ? w.createPortal(c, this.props.appendTo || document.body) : c : null;
  }
  getActionBar(e) {
    return e.filter((t) => t && t.type === p);
  }
  getContent(e) {
    return e.filter((t) => t && t.type !== p);
  }
  generateTitleId() {
    return "dialog-title-" + this._id;
  }
  generateContentId() {
    return "dialog-content-" + this._id;
  }
};
i.displayName = "Dialog", i.propTypes = {
  title: s.any,
  id: s.string,
  dir: s.string,
  style: s.object,
  closeIcon: s.bool,
  width: s.oneOfType([s.number, s.string]),
  height: s.oneOfType([s.number, s.string]),
  minWidth: s.oneOfType([s.number, s.string]),
  autoFocus: s.bool
}, i.defaultProps = {
  autoFocus: !1
}, i.contextType = d;
let r = i;
const U = _(), G = B(
  L(
    U,
    r
  )
);
G.displayName = "KendoReactDialog";
export {
  G as Dialog,
  U as DialogPropsContext
};
